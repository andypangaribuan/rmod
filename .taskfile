#!/bin/bash

# Copyright (c) 2026.
# Created by Andy Pangaribuan. All Rights Reserved.
# This product is protected by copyright and distributed under
# licenses restricting copying, distribution and decompilation.



#: do cargo build and lint
function run {
  devbox run check
  devbox run build
  devbox run lint
}


#: clean the project
function clean {
  devbox run clean
}


#: do cargo test
function test {
  devbox run test
}


#: run cspell to check the project words
function spell {
  spell-rs
}


#: space


#: open devbox shell #: opt: --fresh (delete .cargo and .rustup directories first)
function shell {
  if [[ $1 == "--fresh" ]]; then
    rm -rf .cargo .rustup
  fi

  devbox shell
}


#: space



#: show contributor who make commits
function contributor {
  git log --pretty=format:"%an <%ae>" | sort | uniq
}


#: rewrite author
function rewrite-author {
  # brew install git-filter-repo
  git filter-repo --commit-callback '
  if (b"google-labs-jules" in commit.author_name or
      b"google-labs-jules" in commit.author_email):
      commit.author_name = b"Andy Pangaribuan"
      commit.author_email = b"iam.pangaribuan@gmail.com"
  '
}



#: space
[ -z "$TASKFILE_EXECUTOR" ] && sq taskfile --execute "$@"
